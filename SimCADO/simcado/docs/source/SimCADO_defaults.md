
# SimCADO configuration for MICADO

SimCADO's main purpose is to simulate the optical train comprising of the E-ELT and MICADO. As such the base configuration is for this instrument/telescope combination.

Although SimCADO allows the user to configure the optical train as they like, it is *highly* recommended to leave the default parameters alone if the goal of the simulations is comparability between scientific use cases.

This document lists the current configuration which best describes MICADO. Each section describes a physical effect included by SimCADO and **gives the Keyword/Value pair** contained in the default configuration file **for MICADO**.

## MICADO optical elements

------ 

### Point spread function

`SCOPE_PSF_FILE = data/PSF_POPPY.fits`          Source: Generated by JWST/POPPY, updated on 02.11.2016

**Description:** Currently waiting on SCAO PSFs for the default. If there are none ready, we will ship with the ESO LTAO PSFs from the 2012 AO study for a 42m mirror. 

Other options include using the POPPY PSF simulator from the JWST to make PSFs on the fly

 ------ 

### Atmospheric Dispersion Correction

`INST_ADC_PERFORMANCE  = 100`          Source: Best guess, updated on 02.11.2016, **REAL DATA NEEDED**

`INST_ADC_NUM_SURFACES  = 8`          Source: Email from Ric, updated on 02.11.2016, **Source needed**

`INST_ADC_TC  = data/TC_ADC.dat`          Source: Best guess, updated on 02.11.2016, **REAL DATA NEEDED**

![./images/TC_ADC.dat.png](./images/TC_ADC.dat.png) 

**Description:** The number of surfaces in the ADC is set to 8. A constant transmission curve of 0.98 is assumed for each of these surfaces, thus the total throughput of a perfectly functioning ADC is `0.98^8 = 0.85` over the wavelength range 0.5-3.0um

SimCADO implements an inverse ADC. It assumes that the ADC corrects perfectly for the dispersion induced by the atmosphere. If the ADC isn't working as it should, i.e. `INST_ADC_PERFORMANCE` less than 100%, SimCADO calculates the distance an uncorrected image/slice would be from the centre of the FoV, then shifts the image/slice by `shift = AD * (1 - 0.01 * INST_ADC_PERFORMANCE)`. By calculating this shift for each slice in the spectral cube, SimCADO recreates the smearing effect of an imperfect ADC

 ------ 

### Derotator

`INST_DEROT_PERFORMANCE = 100`          Source: Best guess, updated on 02.11.2016, **REAL DATA NEEDED**

`INST_DEROT_PROFILE = linear`          Source: Best guess, updated on 02.11.2016, **REAL DATA NEEDED**

**Description:** **Not fully implemented**

Similar to the ADC, SimCADO assumes the derotator is perfect. If the performance is less that 100%, SimCADO calculates the field rotation based on the `OBS_EXPTIME` value and then creates a series of rotated focal plane readouts and adds them together to simulate the rotational smear of a poor derotator performance.

`INST_DEROT_PROFILE` can be linear or gaussian

 ------ 

### MICADO mirrors

`INST_NUM_MIRRORS = 11`          Source: Email from Ric, updated on 02.11.2016, **Source needed**

`INST_MIRROR_TC = data/TC_mirror_mgf2agal.dat`          Source: ESO E-ELT technical database, updated on 02.11.2016, **REAL DATA NEEDED**

![./images/TC_mirror_mgf2agal.dat.png](./images/TC_mirror_mgf2agal.dat.png) 

**Description:** For Wide-field (4mas) mode, 11 mirrors are in the optical train. For Zoom (1.5mas) mode, 13 mirrors are used. 

The default mirror coating is currently the same as the E-ELTs MgF2 coating with a AgAl protective layer. **Are MICADOs mirror coatings similar?**

 ------ 

### Filters

`INST_FILTER_TC = data/TC_filter_K.dat`          Source: ESO E-ELT technical database, updated on 02.11.2016

![./images/TC_filter_K.dat.png](./images/TC_filter_K.dat.png) 

**Description:** The transmission curves for filters are for the filter as a whole unit. Individual surface transmission curves (i.e. 2 per filter) are not taken into account.

SimCADO currently accepts all the broadband filters in the MICADO wavelength range as well as a series of narrow band filters:
* I, z, Y, J, H, Ks, K
* Bracket Gamma (2.16um)
* Paschen Beta (1.28um)
* CH4 at 1.69um
* CH4 at 2.27um
* FeII at 1.66um
* H2 at 2.12um
* H2O at 2.04um
* NH3 at 1.52um

More filters can be added upon request

 ------ 

### Cryostat window

`INST_ENTR_NUM_SURFACES = 4`          Source: Email from Ric, updated on 02.11.2016

`INST_ENTR_WINDOW_TC = data/TC_window.dat`          Source: Best guess, updated on 02.11.2016

![./images/TC_window.dat.png](./images/TC_window.dat.png) 

------ 

### Instrumental distorion

`INST_DISTORTION_MAP = none`          Source: Currently not implemented in SimCADO, updated on 02.11.2016

------ 

### Dichroics

`INST_DICHROIC_NUM_SURFACES = 2`          Source: Best guess, updated on 02.11.2016

`INST_DICHROIC_TC = data/TC_dichroic.dat`          Source: Best guess, updated on 02.11.2016

![./images/TC_dichroic.dat.png](./images/TC_dichroic.dat.png) 

**Description:** The question is if these are really necessary in the simulations, seeing as they only affect a small area of the pupil

 ------ 

### Pupil optics

`INST_PUPIL_NUM_SURFACES = 2`          Source: Email from Ric, updated on 02.11.2016, **Source needed**

`INST_PUPIL_TC = data/TC_pupil.dat`          Source: Best guess, updated on 02.11.2016, **REAL DATA NEEDED**

**Description:** **How do the pupil optics affect the image in practical terms?**

 ## MICADO Detector effects

------ 

### Quantum efficiency

`FPA_QE = data/TC_detector_H4RG.dat`          

![./images/TC_detector_H4RG.dat.png](./images/TC_detector_H4RG.dat.png) 

------ 

### Chip noise characteristics

`FPA_USE_NOISE = yes`          

`FPA_NOISE_PATH = data/FPA_noise.fits`          

`FPA_READOUT_MEDIAN = 4`          

`FPA_READOUT_STDEV = 1`          

`FPA_DARK_MEDIAN = 0.01`          

`FPA_DARK_STDEV = 0.01`          

**Description:** If a noise file (`FPA_NOISE_PATH`) is provided, then this is used as the chip noise. This file must however be downloaded and added to the package as it is not shipped with SimCADO due to size

`FPA_USE_NOISE` toggles the detector noise on and off

Read noise and dark current are based on the defaults from the Hawaii xRG noise generator code (Rauscher 2015)

 ------ 

### Chip dynamic range

`FPA_GAIN = 1`          

`FPA_WELL_DEPTH = 100000`          

`FPA_LINEARITY_CURVE = none`          

------ 

### Hawaii 4RG Simulator

`HXRG_NUM_OUTPUTS = 32`          

**Description:** Number of read out channels per chip

 `HXRG_NUM_ROW_OH = 8`          

**Description:** Number of row overhead in pixels

 `HXRG_CORR_PINK = 3`          

**Description:** Factor for correlated pink noise

 `HXRG_UNCORR_PINK = 1`          

**Description:** Factor for uncorrelated pink noise

 `HXRG_ALT_COL_NOISE = 0.5`          

**Description:** Factor for Alternating Column Noise

 `HXRG_PEDESTAL = 4`          

**Description:** Magnitude of pedestal drift

 **Description:** These values are the defaults from the Hawaii xRG noise generator code (Rauscher 2015)

[https://arxiv.org/abs/1509.06264]()

 ------ 

### Pixel sensitivity

`FPA_PIXEL_MAP = none`          

`FPA_DEAD_PIXELS = 1%`          Source: Simms+ 2007 for H2RG, updated on 02.11.2016

`FPA_DEAD_LINES = 1%`          

**Description:** The pixel sensitivity of a detector. Can be specified as a FITS file covering the 4k detector, or a random sample of dead lines/pixels. The default is  `FPA_PIXEL_MAP = none`, and so SimCADO creates dead pixels and lines

The units are in [%], i.e. the default values are 1%

**Needs to be revised for hot pixels**

 ------ 

### Detector layout

`FPA_CHIP_LAYOUT = data/FPA_chip_layout_small.dat`          

**Description:** For the sake of quick computations, the default value for the SimCADO detector array (`small`) describes a single 1024x1024 pixel windowed read-out at the centre of the FoV. 

This allows the user to gain a quick look at whether the output will be useful before investing >10 minutes is a full simulation.

Acceptable values for `FPA_CHIP_LAYOUT`
* "small"   - 1x 1k-detector centred in the FoV
* "centre"  - 1x 4k detector centred in the FoV
* "wide"    - 9x 4k-detector as per MICADO wide field mode (4mas)
* "zoom"    - 9x 4k-detector as per MICADO zoom mode (1.5mas)
* "default" - depends on "mode" keyword. Full MICADO detector array.

Custom layouts for different windowing schemes are also possible by specifying the position of the centre of the window and its width/height in pixels in `arcsec` relative to the centre of the FoV.

 ------ 

### MICADO Detector read modes

## External optical elements

------ 

### MAORY mirrors

`INST_NUM_AO_MIRRORS = 8`          Source: Best guess, updated on 02.11.2016, **REAL DATA NEEDED**

`INST_MIRROR_AO_TC = data/TC_mirror_mgf2agal.dat`          Source: Best guess, updated on 02.11.2016, **REAL DATA NEEDED**

`INST_MIRROR_AO_SUM_AREA = 6.28 m^2`          Source: Best guess, updated on 02.11.2016

`INST_MIRROR_AO_TEMP = 0 deg Celcius`          Source: Best guess, updated on 02.11.2016

**Description:** The same mirror coating is assumed for the MAORY mirrors as for the E-ELT and MICADO

Here we also assume 8x 1m class mirrors, held at ambient temperature emitting as grey bodies. The total surface area (`INST_MIRROR_AO_SUM_AREA`) of all mirrors in the AO system are used for the thermal background

 ## Telescope optics

------ 

### E-ELT optical surfaces

`SCOPE_NUM_MIRRORS = 5`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M1_TC = data/TC_mirror_mgf2agal.dat`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

![./images/TC_mirror_mgf2agal.dat.png](./images/TC_mirror_mgf2agal.dat.png) 

`SCOPE_M1_TEMP = 0 deg Celcius`          

`SCOPE_M1_DIAMETER_OUT = 37.3`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M1_DIAMETER_IN = 11.1`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M2_DIAMETER_OUT = 4.2`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M2_DIAMETER_IN = 0.545`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M3_DIAMETER_OUT = 3.8`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M3_DIAMETER_IN = 0.14`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M4_DIAMETER_OUT = 2.4`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M4_DIAMETER_IN = 0.`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M5_DIAMETER_OUT = 2.4`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M5_DIAMETER_IN = 0.`          Source: ESO E-ELT optics webpage, updated on 02.11.2016

`SCOPE_M6_DIAMETER_OUT = 2.4`          

`SCOPE_M6_DIAMETER_IN = 0.`          

------ 

### Wind jitter and telescope vibrations

`SCOPE_JITTER_FWHM = 0.001 arcsec`          

`SCOPE_DRIFT_DISTANCE = 0 arcsec/sec`          

`SCOPE_DRIFT_PROFILE = linear`          

## Atmospheric Effects

------ 

### Background light

`ATMO_USE_ATMO_BG = yes`          

`ATMO_EC = data/skytable.fits`          

`ATMO_BG_MAGNITUDE = data/EC_sky_magnitude.dat`          

------ 

### Transmission

`ATMO_TC = data/skytable.fits`          

------ 

### Atmospheric conditions

`ATMO_TEMPERATURE = 0 deg Celcius`          

`ATMO_PRESSURE = 750 millibar`          

`ATMO_REL_HUMIDITY = 60%`          

------ 

### Telescope location parameters

`SCOPE_ALTITUDE = 3060 m`          

`SCOPE_LATITUDE = -24.589167 deg`          

`SCOPE_LONGITUDE = -70.192222 deg`          

